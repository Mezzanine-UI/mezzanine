@use 'sass:map';
@use '../size';
@use '../palette';
@use '../typography';
@use '../icon';
@use '../typography/utils' as utils-typography;
@use './utils';

$prefix: mzn-input;
$inputSizes: size.$sizes;

$default-options: (
  padding-x: 16px,
  padding-x-small: 12px,
  padding-x-with-icon: 12px,
  padding-x-small-with-icon: 8px,
  icon-size: 24px,
  icon-size-small: 16px,
  padding-decorator: 4px,
);

@function _get-typography-variant-from-size($size) {
  @return map.get(
    (
      small: input3,
      medium: input2,
      large: input1,
    ),
    $size
  );
}

@mixin _padding-x($options, $is-outlined) {
  $padding-x: utils-typography.px-to-rem(map.get($options, padding-x));
  $padding-x-small: utils-typography.px-to-rem(map.get($options, padding-x-small));
  $padding-x-with-icon: utils-typography.px-to-rem(map.get($options, padding-x-with-icon));
  $padding-x-small-with-icon: utils-typography.px-to-rem(map.get($options, padding-x-small-with-icon));

  padding: 0 $padding-x;

  &.mzn-input-icon--start {
    padding: 0 $padding-x 0 $padding-x-with-icon;
  }

  &.mzn-input-icon--end {
    padding: 0 $padding-x-with-icon 0 $padding-x;
  }

  &.#{$prefix}--small {
    padding: 0 $padding-x-small;

    &.mzn-input-icon--start {
      padding: 0 $padding-x 0 $padding-x-small-with-icon;
    }

    &.mzn-input-icon--end {
      padding: 0 $padding-x-small-with-icon 0 $padding-x;
    }
  }
}

@mixin _size($options) {
  $padding-x: map.get($options, padding-x);
  $padding-x-small: map.get($options, padding-x-small);
  $icon-size: map.get($options, icon-size);
  $icon-size-small: map.get($options, icon-size-small);

  .#{icon.$prefix} {
    font-size: utils-typography.px-to-rem($icon-size);
  }

  @each $size in $inputSizes {
    $typography-variant: _get-typography-variant-from-size($size);

    &--#{$size} {
      @include typography.variant($typography-variant);

      @if $size == small {
        .#{icon.$prefix} {
          font-size: utils-typography.px-to-rem($icon-size-small);
        }
      }
    }
  }
}

@mixin _icon-button-size() {
  padding: 0;

  .#{icon.$prefix} {
    margin: 0;
  }
}

@mixin core($options: ()) {
  $options: map.deep-merge($default-options, $options);

  // ::placeholder { /* Chrome, Firefox, Opera, Safari 10.1+ */
  //   color: #8F8F8F;
  //   opacity: 1; /* Firefox */
  // }

  .#{$prefix} {
    @include utils.reset();

    border: none;
    outline: none;
    background-color: transparent;

    &--wrapper {
      display: inline-flex;
      position: relative;
      justify-content: space-between;
      border-width: 1px;
      border-style: solid;
      border-color: palette.color(border);

      &:hover {
        &:not(.#{$prefix}--disabled):not(.#{$prefix}--error) {
          &:hover {
            border-color: palette.color(primary);
          }
        }
      }

      @include _padding-x($options, false);
    }

    &--wrapper:focus-within {
      border-color: palette.color(primary);

      &:not(.#{$prefix}--disabled) {
        border-color: palette.color(primary);
      }
    }

    @include _size($options);

    &--error {
      border-color: palette.color(error);
    }

    &--errorMessage {
      @include typography.variant(caption);

      white-space: nowrap;
      color: palette.color(error);
      position: absolute;
      right: 0;
      bottom: -20px;
    }

    &--disabled {
      border-color: palette.color(action-disabled);
    }

    &--clearButton {
      border: none;
      padding: 0;
      background-color: transparent;
      outline: none;
      cursor: pointer;

      &:hover {
        color: palette.color(primary);
      }
    }

    &-decorator {
      display: flex;
      justify-content: center;
      align-items: center;
      white-space: nowrap;
      color: var(--mzn-color-action-inactive);

      @include _size($options);

      $padding-decorator: utils-typography.px-to-rem(map.get($options, padding-decorator));

      &.mzn-input-text--start {
        padding: 0 $padding-decorator 0 0;
      }

      &.mzn-input-text--end {
        padding: 0 0 0 $padding-decorator;
      }

      &.mzn-input-icon--start {
        padding: 0 $padding-decorator 0 0;
      }

      &.mzn-input-icon--end {
        padding: 0 0 0 $padding-decorator;
      }
    }
  }
}
