@use 'sass:map';
@use '~@mezzanine-ui/system/palette';
@use '~@mezzanine-ui/system/typography';
@use '~@mezzanine-ui/system/radius';
@use '~@mezzanine-ui/system/spacing';
@use './tag' as *;

$tag-config: (
  static: (
    text-color: palette.semantic-variable(text, brand-solid),
    background-color: palette.semantic-variable(background, brand-faint)
  ),
  counter: (
    gap: (
      main: spacing.semantic-variable(gap, tight),
      sub: spacing.semantic-variable(gap, tiny)
    ),
    text-color: palette.semantic-variable(text, brand-solid),
    background-color: palette.semantic-variable(background, brand-faint)
  ),
  overflow-counter: (
    gap: (
      main: spacing.semantic-variable(gap, tiny),
      sub: spacing.semantic-variable(gap, tiny)
    ),
    text-color: palette.semantic-variable(text, brand-solid),
    icon-color: palette.semantic-variable(icon, brand-solid),
    background-color: palette.semantic-variable(background, brand-faint)
  ),
  dismissable: (
    gap: (
      main: spacing.semantic-variable(gap, tight),
      sub: spacing.semantic-variable(gap, tiny)
    ),
    text-color: palette.semantic-variable(text, brand-solid),
    icon-color: palette.semantic-variable(icon, neutral),
    background-color: palette.semantic-variable(background, brand-faint),
    hover: (
      text-color: palette.semantic-variable(text, brand-solid),
      icon-color: palette.semantic-variable(icon, neutral-solid),
      background-color: palette.semantic-variable(background, brand-subtle)
    ),
    active: (
      text-color: palette.semantic-variable(text, brand-solid),
      icon-color: palette.semantic-variable(icon, neutral-solid),
      background-color: palette.semantic-variable(background, brand-light)
    ),
    disabled: (
      text-color: palette.semantic-variable(text, neutral-light),
      icon-color: palette.semantic-variable(icon, neutral-light),
      background-color: palette.semantic-variable(background, neutral-subtle),
      border: 1px solid palette.semantic-variable(border, neutral-light)
    ),
    read-only: (
      text-color: palette.semantic-variable(text, neutral-solid),
      background-color: unset,
      border: 1px solid palette.semantic-variable(border, neutral-light)
    )
  ),
  addable: (
    gap: (
      main: spacing.semantic-variable(gap, tight),
      sub: spacing.semantic-variable(gap, tiny)
    ),
    text-color: palette.semantic-variable(text, neutral-solid),
    icon-color: palette.semantic-variable(icon, neutral),
    background-color: unset,
    border: 1px dashed palette.semantic-variable(border, neutral-light),
    hover: (
      text-color: palette.semantic-variable(text, neutral-solid),
      icon-color: palette.semantic-variable(icon, neutral-solid),
      border: 1px dashed palette.semantic-variable(border, neutral)
    ),
    active: (
      text-color: palette.semantic-variable(text, neutral-solid),
      icon-color: palette.semantic-variable(icon, neutral-solid),
      border: 1px dashed palette.semantic-variable(border, neutral-strong)
    ),
    disabled: (
      text-color: palette.semantic-variable(text, neutral-light),
      icon-color: palette.semantic-variable(icon, neutral-light),
      border: 1px dashed palette.semantic-variable(border, neutral-light)
    )
  )
);

@mixin _tag-state-styles($config) {
  // Text color
  .#{$prefix}__label {
    color: map.get($config, text-color);
  }

  // Icon color
  @if map.has-key($config, icon-color) {
    .#{$prefix}__icon {
      color: map.get($config, icon-color);
    }
  }

  // Background color
  @if map.has-key($config, background-color) {
    background-color: map.get($config, background-color);
  }

  // Border
  @if map.has-key($config, border) {
    border: map.get($config, border);
  }
}

.#{$prefix} {
  @include typography.semantic-variable(label-primary);

  box-sizing: border-box;
  display: inline-flex;
  align-items: center;
  flex-shrink: 0;
  border-radius: radius.variable(base);
  width: fit-content;
  height: fit-content;

  @each $type in $tag-types {
    $type-config: map.get($tag-config, $type);

    &--#{$type} {
      // Default style
      @include _tag-state-styles(map.get($tag-config, $type));

      // Hover style
      @if map.has-key($type-config, hover) {
        $type-hover-config: map.get($type-config, hover);

        &:not(.#{$prefix}--active):not(.#{$prefix}--disabled):not(.#{$prefix}--read-only):hover {
          @include _tag-state-styles($type-hover-config);
        }
      }

      // Active style
      @if map.has-key($type-config, active) {
        $type-active-config: map.get($type-config, active);

        &.#{$prefix}--active {
          @include _tag-state-styles($type-active-config);
        }
      }

      // Disabled style
      @if map.has-key($type-config, disabled) {
        $type-disabled-config: map.get($type-config, disabled);

        &.#{$prefix}--disabled {
          @include _tag-state-styles($type-disabled-config);
        }
      }

      // ReadOnly style
      @if map.has-key($type-config, read-only) {
        $type-readonly-config: map.get($type-config, read-only);

        &.#{$prefix}--read-only {
          @include _tag-state-styles($type-readonly-config);
        }
      }
    }

    // Main size
    &.#{$prefix}--main.#{$prefix}--#{$type} {
      padding: spacing.semantic-variable(padding, vertical, tight);

      &:has(> :first-child.#{$prefix}__label) {
        padding-left: spacing.semantic-variable(padding, horizontal, base);
      }

      &:has(> :last-child.#{$prefix}__label) {
        padding-right: spacing.semantic-variable(padding, horizontal, base);
      }

      @if map.has-key($type-config, gap) {
        column-gap: map.get($tag-config, $type, gap, main);
      }
    }

    // Sub size
    &.#{$prefix}--sub.#{$prefix}--#{$type} {
      padding: spacing.semantic-variable(padding, vertical, micro);

      &:has(> :first-child.#{$prefix}__label) {
        padding-left: spacing.semantic-variable(padding, horizontal, tiny);
      }

      &:has(> :last-child.#{$prefix}__label) {
        padding-right: spacing.semantic-variable(padding, horizontal, tiny);
      }

      @if map.has-key($type-config, gap) {
        column-gap: map.get($tag-config, $type, gap, sub);
      }
    }
  }

  &__close-button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    background-color: transparent;
    padding: 0;
    margin: 0;
    border-radius: 0;
    flex-shrink: 0;
    border: 0;
  }

  &:is(button),
  & &__close-button {
    cursor: pointer;

    &:disabled {
      cursor: default;
    }
  }

  &__group {
    flex-grow: 1;
    display: inline-flex;
    flex-wrap: wrap;
    justify-content: flex-start;
    align-items: center;
    gap: spacing.semantic-variable(gap, tight);
    width: fit-content;
    height: fit-content;
  }
}
