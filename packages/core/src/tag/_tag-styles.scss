@use 'sass:map';
@use '~@mezzanine-ui/system/palette';
@use '~@mezzanine-ui/system/typography';
@use '~@mezzanine-ui/system/radius';
@use '~@mezzanine-ui/system/spacing';
@use '~@mezzanine-ui/system/transition';
@use './tag' as *;

$tag-type-config: (
  static: (
    text-color: palette.semantic-variable(text, brand-solid),
    background-color: palette.semantic-variable(background, brand-faint),
    // Background-colored border to keep height consistent across states
    border: 1px solid palette.semantic-variable(background, brand-faint),
    read-only: (
      text-color: palette.semantic-variable(text, neutral-solid),
      background-color: unset,
      border: 1px solid palette.semantic-variable(border, neutral-light),
    ),
  ),
  counter: (
    text-color: palette.semantic-variable(text, brand-solid),
    background-color: palette.semantic-variable(background, brand-faint),
  ),
  overflow-counter: (
    text-color: palette.semantic-variable(text, brand-solid),
    icon-color: palette.semantic-variable(icon, brand-solid),
    background-color: palette.semantic-variable(background, brand-faint),
    // Background-colored border to keep height consistent across states
    border: 1px solid palette.semantic-variable(background, brand-faint),
    disabled: (
      text-color: palette.semantic-variable(text, neutral-light),
      icon-color: palette.semantic-variable(icon, neutral-light),
      background-color: palette.semantic-variable(background, neutral-subtile),
      border: 1px solid palette.semantic-variable(border, neutral-light),
    ),
    read-only: (
      text-color: palette.semantic-variable(text, neutral-solid),
      icon-color: palette.semantic-variable(icon, neutral-solid),
      background-color: unset,
      border: 1px solid palette.semantic-variable(border, neutral-light),
    ),
  ),
  dismissable: (
    text-color: palette.semantic-variable(text, brand-solid),
    icon-color: palette.semantic-variable(icon, neutral),
    background-color: palette.semantic-variable(background, brand-faint),
    // Background-colored border to keep height consistent across states
    border: 1px solid palette.semantic-variable(background, brand-faint),
    hover: (
      text-color: palette.semantic-variable(text, brand-solid),
      icon-color: palette.semantic-variable(icon, neutral-solid),
      background-color: palette.semantic-variable(background, brand-subtle),
      // Background-colored border to keep height consistent across states
      border: 1px solid palette.semantic-variable(background, brand-subtle),
    ),
    active: (
      text-color: palette.semantic-variable(text, brand-solid),
      icon-color: palette.semantic-variable(icon, neutral-solid),
      background-color: palette.semantic-variable(background, brand-light),
      // Background-colored border to keep height consistent across states
      border: 1px solid palette.semantic-variable(background, brand-light),
    ),
    disabled: (
      text-color: palette.semantic-variable(text, neutral-light),
      icon-color: palette.semantic-variable(icon, neutral-light),
      background-color: palette.semantic-variable(background, neutral-subtle),
      border: 1px solid palette.semantic-variable(border, neutral-light),
    ),
  ),
  addable: (
    text-color: palette.semantic-variable(text, neutral-solid),
    icon-color: palette.semantic-variable(icon, neutral),
    background-color: unset,
    border: 1px dashed palette.semantic-variable(border, neutral-light),
    hover: (
      text-color: palette.semantic-variable(text, neutral-solid),
      icon-color: palette.semantic-variable(icon, neutral-solid),
      border: 1px dashed palette.semantic-variable(border, neutral),
    ),
    active: (
      text-color: palette.semantic-variable(text, neutral-solid),
      icon-color: palette.semantic-variable(icon, neutral-solid),
      border: 1px dashed palette.semantic-variable(border, neutral-strong),
    ),
    disabled: (
      text-color: palette.semantic-variable(text, neutral-light),
      icon-color: palette.semantic-variable(icon, neutral-light),
      border: 1px dashed palette.semantic-variable(border, neutral-light),
    ),
  ),
);

$tag-size-config: (
  main: (
    typography: label-primary,
    height: spacing.semantic-variable(size, element, airy),
    padding-vertical: spacing.semantic-variable(padding, vertical, tight),
    padding-horizontal: spacing.semantic-variable(padding, horizontal, tight),
    padding-text-side: spacing.semantic-variable(padding, horizontal, base),
    gap: spacing.semantic-variable(gap, tight),
  ),
  sub: (
    typography: label-primary,
    height: spacing.semantic-variable(size, element, gentle-fixed),
    padding-vertical: spacing.semantic-variable(padding, vertical, micro),
    padding-horizontal: spacing.semantic-variable(padding, horizontal, micro),
    padding-text-side: spacing.semantic-variable(padding, horizontal, tiny),
    gap: spacing.semantic-variable(gap, tiny),
  ),
  minor: (
    typography: caption,
    height: spacing.semantic-variable(size, element, gentle-fixed),
    padding-vertical: spacing.semantic-variable(padding, vertical, micro),
    padding-horizontal: spacing.semantic-variable(padding, horizontal, micro),
    padding-text-side: spacing.semantic-variable(padding, horizontal, tiny),
    gap: spacing.semantic-variable(gap, tiny),
  ),
);

@mixin _tag-state-styles($config) {
  // Text color
  .#{$prefix}__label {
    color: map.get($config, text-color);
  }

  // Icon color
  @if map.has-key($config, icon-color) {
    .#{$prefix}__icon {
      color: map.get($config, icon-color);
    }
  }

  // Background color
  @if map.has-key($config, background-color) {
    background-color: map.get($config, background-color);
  }

  // Border
  @if map.has-key($config, border) {
    border: map.get($config, border);
  }
}

.#{$prefix} {
  box-sizing: border-box;
  display: inline-flex;
  align-items: center;
  flex-shrink: 0;
  border-radius: radius.variable(base);
  width: fit-content;
  transition:
    transition.standard(color, fast),
    transition.standard(background-color, fast),
    transition.standard(border-color, fast);

  @each $type in $tag-types {
    $type-config: map.get($tag-type-config, $type);

    &--#{$type} {
      // Default style
      @include _tag-state-styles(map.get($tag-type-config, $type));

      // Hover style
      @if map.has-key($type-config, hover) {
        $type-hover-config: map.get($type-config, hover);

        &:not(.#{$prefix}--active):not(.#{$prefix}--disabled):not(
            .#{$prefix}--read-only
          ):hover,
        &.is-hover {
          @include _tag-state-styles($type-hover-config);
        }
      }

      // Active style
      @if map.has-key($type-config, active) {
        $type-active-config: map.get($type-config, active);

        &.#{$prefix}--active,
        &:active {
          @include _tag-state-styles($type-active-config);
        }
      }

      // ReadOnly style
      @if map.has-key($type-config, read-only) {
        $type-readonly-config: map.get($type-config, read-only);

        &.#{$prefix}--read-only {
          @include _tag-state-styles($type-readonly-config);
        }
      }

      // Disabled style
      @if map.has-key($type-config, disabled) {
        $type-disabled-config: map.get($type-config, disabled);

        &.#{$prefix}--disabled,
        &:disabled {
          @include _tag-state-styles($type-disabled-config);
        }
      }
    }

    @each $size in $tag-sizes {
      $size-config: map.get($tag-size-config, $size);

      &.#{$prefix}--#{$size}.#{$prefix}--#{$type} {
        @include typography.semantic-variable(
          map.get($size-config, typography)
        );

        height: map.get($size-config, height);
        padding-block: map.get($size-config, padding-vertical);
        padding-inline: map.get($size-config, padding-horizontal);

        &:has(> :first-child.#{$prefix}__label) {
          padding-left: map.get($size-config, padding-text-side);
        }

        &:has(> :last-child.#{$prefix}__label) {
          padding-right: map.get($size-config, padding-text-side);
        }

        @if $type == overflow-counter and $size == main {
          column-gap: spacing.semantic-variable(gap, tiny);
        } @else if $type != static {
          column-gap: map.get($size-config, gap);
        }
      }
    }
  }

  &__close-button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    background-color: transparent;
    padding: 0;
    margin: 0;
    border-radius: 0;
    flex-shrink: 0;
    border: 0;
  }

  &:is(button),
  & &__close-button {
    cursor: pointer;

    &:disabled,
    &.#{$prefix}--disabled,
    &.#{$prefix}--read-only {
      cursor: default;
    }
  }

  &__group {
    flex-grow: 1;
    display: inline-flex;
    flex-wrap: wrap;
    justify-content: flex-start;
    align-items: center;
    gap: spacing.semantic-variable(gap, tight);
    width: fit-content;
    height: fit-content;
  }
}
